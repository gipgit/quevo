generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model business {
  business_id                    String                           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  manager_id                     String                           @db.Uuid
  business_urlname               String                           @unique @db.VarChar(30)
  business_urlname_last_edited   DateTime?                        @db.Timestamp(6)
  business_name                  String                           @db.VarChar(50)
  business_country               String                           @db.VarChar(50)
  business_region                String?                          @db.VarChar(50)
  business_city                  String?                          @db.VarChar(50)
  business_address               String?                          @db.VarChar(80)
  business_phone                 Json?
  business_email                 Json?
  business_descr                 String?
  date_created                   DateTime?                        @default(now()) @db.Timestamp(6)
  company_name                   String?                          @db.VarChar(50)
  company_country                String?                          @db.VarChar(50)
  company_region                 String?                          @db.VarChar(50)
  company_city                   String?                          @db.VarChar(50)
  company_address                String?                          @db.VarChar(80)
  company_vat                    String?                          @db.VarChar(50)
  company_contact                String?                          @db.VarChar(50)
  sponsored                      Boolean?                         @default(false)
  sponsored_level                Int?                             @default(0)
  business_public_uuid           String?                          @unique @db.VarChar(36)
  business_img_profile           String?                          @db.VarChar(255)
  business_img_cover             String?                          @db.VarChar(255)
  aiassistantmessagehistory      aiassistantmessagehistory[]
  aicontentgenerationratelimit   aicontentgenerationratelimit?
  aigenerationemail              aigenerationemail[]
  appointment                    appointment[]
  appsupportrequest              appsupportrequest[]
  usermanager                    usermanager                      @relation(fields: [manager_id], references: [user_id], onDelete: Cascade)
  businessad                     businessad[]
  businesscategory               businesscategory[]
  businesslink                   businesslink[]
  businesspaymentmethod          businesspaymentmethod[]
  businesspoints                 businesspoints[]
  businessprofilesettings        businessprofilesettings?
  businessreward                 businessreward[]
  businesssponsorship            businesssponsorship[]
  cardscan                       cardscan[]
  cardscanauthorized             cardscanauthorized[]
  emailratelimit                 emailratelimit?
  marketingemailcampaign         marketingemailcampaign[]
  product                        product[]
  productcategory                productcategory[]
  promo                          promo[]
  service                        service[]
  serviceboard                   serviceboard[]
  servicecategory                servicecategory[]
  serviceeventavailability       serviceeventavailability[]
  servicerequest                 servicerequest[]
  servicesupportrequest          servicesupportrequest[]
  surveyquestionprebuiltfavorite surveyquestionprebuiltfavorite[]
}

model businessad {
  business_id      String    @db.Uuid
  sponsored_level  Int?      @default(0)
  date_start       DateTime  @db.Date
  date_end         DateTime? @db.Date
  business_urlname String?   @db.VarChar(30)
  business_name    String?   @db.VarChar(50)
  business_country String?   @db.VarChar(50)
  business_region  String?   @db.VarChar(50)
  business_city    String?   @db.VarChar(50)
  business_address String?   @db.VarChar(50)
  business         business  @relation(fields: [business_id], references: [business_id], onDelete: Cascade)

  @@id([business_id, date_start])
}

model businesscategory {
  business_id String   @db.Uuid
  category_id Int
  business    business @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  category    category @relation(fields: [category_id], references: [category_id], onDelete: Cascade)

  @@id([business_id, category_id])
}

model businesslink {
  business_link_id Int      @id @default(autoincrement())
  business_id      String   @db.Uuid
  link_type        String   @db.VarChar(20)
  link_url         String   @db.VarChar(255)
  visible          Boolean? @default(true)
  business         business @relation(fields: [business_id], references: [business_id], onDelete: Cascade)

  @@unique([business_id, link_type])
}

model businesspaymentmethod {
  business_payment_method_id Int           @id @default(autoincrement())
  business_id                String        @db.Uuid
  payment_method_id          Int
  method_details_json        Json?
  visible                    Boolean?      @default(true)
  business                   business      @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  paymentmethod              paymentmethod @relation(fields: [payment_method_id], references: [payment_method_id], onDelete: Cascade)

  @@unique([business_id, payment_method_id])
}

model businesspoints {
  card_number  String       @db.VarChar(20)
  business_id  String       @db.Uuid
  points       Int          @default(0)
  last_updated DateTime?    @default(now()) @db.Timestamp(6)
  business     business     @relation(fields: [business_id], references: [business_id], onDelete: NoAction, onUpdate: NoAction)
  customercard customercard @relation(fields: [card_number], references: [card_number], onDelete: NoAction, onUpdate: NoAction)

  @@id([card_number, business_id])
}

model businessprofilesettings {
  business_id            String    @id @db.Uuid
  default_page           String?   @default("services") @db.VarChar(50)
  theme_color_background String?   @default("#FFFFFF") @db.VarChar(7)
  theme_color_text       String?   @default("#000000") @db.VarChar(7)
  theme_color_button     String?   @default("#000000") @db.VarChar(7)
  theme_font             String?   @default("1") @db.VarChar(2)
  show_address           Boolean?  @default(true)
  show_website           Boolean?  @default(true)
  show_socials           Boolean?  @default(true)
  show_btn_booking       Boolean?  @default(true)
  show_btn_payments      Boolean?  @default(true)
  show_btn_review        Boolean?  @default(true)
  show_btn_phone         Boolean?  @default(true)
  show_btn_email         Boolean?  @default(true)
  show_btn_order         Boolean?  @default(false)
  last_updated           DateTime? @default(now()) @db.Timestamp(6)
  business               business  @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model businessreward {
  business_id        String    @db.Uuid
  reward_id          Int       @id @default(autoincrement())
  reward_description String    @db.VarChar(255)
  required_points    Int
  reward_start_date  DateTime? @db.Date
  reward_end_date    DateTime? @db.Date
  quantity_available Int?
  business           business  @relation(fields: [business_id], references: [business_id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model businesssponsorship {
  business_id            String                              @db.Uuid
  sponsorship_date_start DateTime                            @db.Date
  sponsorship_date_end   DateTime                            @db.Date
  sponsorship_level      business_sponsorship_level
  ad_content             String?
  payment_amount         Decimal                             @db.Decimal(10, 2)
  payment_status         business_sponsorship_payment_status @default(pending)
  transaction_id         String?                             @db.VarChar(255)
  business               business                            @relation(fields: [business_id], references: [business_id], onDelete: Cascade)

  @@id([business_id, sponsorship_date_start])
}

model cardscan {
  card_number      String       @db.VarChar(20)
  business_id      String       @db.Uuid
  datetime_scanned DateTime     @default(now()) @db.Timestamp(6)
  datetime_created DateTime?    @default(now()) @db.Timestamp(6)
  business         business     @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  customercard     customercard @relation(fields: [card_number], references: [card_number], onDelete: Cascade)

  @@id([card_number, business_id, datetime_scanned])
}

model cardscanauthorized {
  card_number         String       @db.VarChar(20)
  business_id         String       @db.Uuid
  datetime_authorized DateTime     @default(now()) @db.Timestamp(6)
  datetime_created    DateTime?    @default(now()) @db.Timestamp(6)
  promo_authorized    String?      @db.Uuid
  business            business     @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  customercard        customercard @relation(fields: [card_number], references: [card_number], onDelete: Cascade)
  promo               promo?       @relation(fields: [promo_authorized], references: [promo_id], onDelete: Cascade)

  @@id([card_number, business_id, datetime_authorized])
}

model category {
  category_id          Int                @id @default(autoincrement())
  category_name        String             @unique @db.VarChar(50)
  category_description String?
  businesscategory     businesscategory[]
}

model customercard {
  card_number        String               @id @db.VarChar(20)
  user_id            String               @db.Uuid
  date_issue         DateTime?            @default(now()) @db.Timestamp(6)
  status             customer_card_status @default(active)
  points             Int                  @default(0)
  businesspoints     businesspoints[]
  cardscan           cardscan[]
  cardscanauthorized cardscanauthorized[]
  usercustomer       usercustomer         @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}

model paymentmethod {
  payment_method_id     Int                     @id @default(autoincrement())
  method_name           String                  @unique @db.VarChar(50)
  businesspaymentmethod businesspaymentmethod[]
}

model promo {
  promo_id               String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  business_id            String                   @db.Uuid
  promo_title            String                   @db.VarChar(50)
  promo_text_full        String                   @db.VarChar(100)
  promo_conditions       String?                  @db.VarChar(255)
  date_start             DateTime?                @db.Date
  date_end               DateTime?                @db.Date
  date_created           DateTime?                @default(now()) @db.Timestamp(6)
  date_update            DateTime?                @default(now()) @db.Timestamp(6)
  promo_nickname         String                   @db.VarChar(30)
  locked                 Boolean                  @default(false)
  cardscanauthorized     cardscanauthorized[]
  business               business                 @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  promochallenge         promochallenge[]
  usercustomerredemption usercustomerredemption[]
  userguest              userguest[]
  userguestredemption    userguestredemption[]
}

model promochallenge {
  challenge_id                 Int                            @id @default(autoincrement())
  promo_id                     String                         @db.Uuid
  challenge_type               promo_challenge_type
  title                        String                         @db.VarChar(255)
  description                  String?
  challenge_order              Int
  challenge_data               Json?
  is_active                    Boolean?                       @default(true)
  date_created                 DateTime?                      @default(now()) @db.Timestamp(6)
  date_updated                 DateTime?                      @default(now()) @db.Timestamp(6)
  promo                        promo                          @relation(fields: [promo_id], references: [promo_id], onDelete: Cascade, onUpdate: NoAction)
  surveydefinition             surveydefinition?
  userchallengecompletion      userchallengecompletion[]
  userguestchallengecompletion userguestchallengecompletion[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model surveyanswer {
  answer_id            Int                         @id @default(autoincrement())
  survey_definition_id Int
  question_id          Int
  question_type        survey_answer_question_type
  user_id              String?                     @db.Uuid
  guest_id             String?                     @db.VarChar(128)
  answer_text          String?
  answered_at          DateTime?                   @default(now()) @db.Timestamp(6)
  userguest            userguest?                  @relation(fields: [guest_id], references: [guest_id], onDelete: Cascade, onUpdate: NoAction)
  surveydefinition     surveydefinition            @relation(fields: [survey_definition_id], references: [survey_definition_id], onDelete: Cascade, onUpdate: NoAction)
  usercustomer         usercustomer?               @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([survey_definition_id, question_id, question_type], map: "idx_answer_survey_question")
  @@index([user_id, guest_id], map: "idx_answer_user_guest")
}

model surveydefinition {
  survey_definition_id     Int                        @id @default(autoincrement())
  promo_challenge_id       Int                        @unique
  is_active                Boolean?                   @default(true)
  date_created             DateTime?                  @default(now()) @db.Timestamp(6)
  surveyanswer             surveyanswer[]
  promochallenge           promochallenge             @relation(fields: [promo_challenge_id], references: [challenge_id], onDelete: Cascade, onUpdate: NoAction)
  surveydefinitionquestion surveydefinitionquestion[]
}

model surveydefinitionquestion {
  survey_definition_question_id Int                         @id @default(autoincrement())
  survey_definition_id          Int
  question_id                   Int
  question_source               survey_question_source_type
  question_order                Int
  surveydefinition              surveydefinition            @relation(fields: [survey_definition_id], references: [survey_definition_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([survey_definition_id, question_id, question_source])
}

model surveyquestionbusiness {
  question_id     Int                         @id @default(autoincrement())
  business_id     String                      @db.Uuid
  question_text   String
  question_format survey_question_format_type
  options_data    Json?
  is_active       Boolean?                    @default(true)
  date_created    DateTime?                   @default(now()) @db.Timestamp(6)
  date_updated    DateTime?                   @default(now()) @db.Timestamp(6)
}

model surveyquestionprebuilt {
  question_prebuilt_id           Int                              @id @default(autoincrement())
  question_text                  String
  question_format                survey_question_format_type
  options_data                   Json?
  is_active                      Boolean?                         @default(true)
  date_created                   DateTime?                        @default(now()) @db.Timestamp(6)
  date_updated                   DateTime?                        @default(now()) @db.Timestamp(6)
  surveyquestionprebuiltfavorite surveyquestionprebuiltfavorite[]
}

model surveyquestionprebuiltfavorite {
  business_id            String                 @db.Uuid
  question_prebuilt_id   Int
  date_favorited         DateTime?              @default(now()) @db.Timestamp(6)
  business               business               @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  surveyquestionprebuilt surveyquestionprebuilt @relation(fields: [question_prebuilt_id], references: [question_prebuilt_id], onDelete: Cascade)

  @@id([business_id, question_prebuilt_id])
}

model userchallengecompletion {
  user_challenge_completion_id Int            @id @default(autoincrement())
  user_id                      String         @db.Uuid
  challenge_id                 Int
  completion_date              DateTime?      @default(now()) @db.Timestamp(6)
  promochallenge               promochallenge @relation(fields: [challenge_id], references: [challenge_id], onDelete: Cascade, onUpdate: NoAction)
  usercustomer                 usercustomer   @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, challenge_id])
}

model usercustomer {
  user_id                 String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name_first              String?                     @db.VarChar(50)
  name_last               String?                     @db.VarChar(50)
  email                   String                      @unique @db.VarChar(255)
  phone                   String?                     @unique @db.VarChar(20)
  date_created            DateTime?                   @default(now()) @db.Timestamp(6)
  active                  user_customer_active_status @default(inactive)
  birth_date              DateTime?                   @db.Date
  birth_country           String?                     @db.VarChar(50)
  gender                  user_gender_type?
  residence_country       String?                     @db.VarChar(50)
  residence_region        String?                     @db.VarChar(50)
  residence_city          String?                     @db.VarChar(50)
  password                String?                     @db.VarChar(255)
  token_activation        String?                     @unique @db.VarChar(255)
  user_public_uuid        String?                     @unique @db.VarChar(36)
  updated_at              DateTime                    @default(now()) @db.Timestamptz(6)
  appointment             appointment[]
  customercard            customercard[]
  serviceboard            serviceboard[]
  serviceboardaction      serviceboardaction[]
  servicerequest          servicerequest[]
  servicesupportrequest   servicesupportrequest[]
  surveyanswer            surveyanswer[]
  userchallengecompletion userchallengecompletion[]
  usercustomerredemption  usercustomerredemption[]
}

model usercustomerredemption {
  redemption_id          Int          @id @default(autoincrement())
  redemption_token       String       @unique @db.VarChar(36)
  user_id                String       @db.Uuid
  promo_id               String       @db.Uuid
  qr_content_data        String?
  date_issued            DateTime?    @default(now()) @db.Timestamp(6)
  date_expires           DateTime?    @db.Timestamp(6)
  is_redeemed            Boolean?     @default(false)
  date_redeemed          DateTime?    @db.Timestamp(6)
  redeemed_by_manager_id String?      @db.Uuid
  promo                  promo        @relation(fields: [promo_id], references: [promo_id], onDelete: NoAction, onUpdate: NoAction)
  usermanager            usermanager? @relation(fields: [redeemed_by_manager_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  usercustomer           usercustomer @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model userguest {
  guest_id                     String                         @id @db.VarChar(128)
  session_id                   String?                        @unique @db.VarChar(255)
  date_created                 DateTime?                      @default(now()) @db.Timestamp(6)
  last_active                  DateTime?                      @default(now()) @db.Timestamp(6)
  email                        String?                        @db.VarChar(255)
  promo_unlocked_promo_id      String?                        @db.Uuid
  surveyanswer                 surveyanswer[]
  promo                        promo?                         @relation(fields: [promo_unlocked_promo_id], references: [promo_id], onDelete: NoAction, onUpdate: NoAction)
  userguestchallengecompletion userguestchallengecompletion[]
  userguestredemption          userguestredemption[]
}

model userguestchallengecompletion {
  guest_challenge_completion_id Int            @id @default(autoincrement())
  guest_id                      String         @db.VarChar(128)
  challenge_id                  Int
  completion_date               DateTime?      @default(now()) @db.Timestamp(6)
  data_submitted                String?
  promochallenge                promochallenge @relation(fields: [challenge_id], references: [challenge_id], onDelete: NoAction, onUpdate: NoAction)
  userguest                     userguest      @relation(fields: [guest_id], references: [guest_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([guest_id, challenge_id])
}

model userguestredemption {
  redemption_id          Int          @id @default(autoincrement())
  redemption_token       String       @unique @db.VarChar(36)
  email                  String?      @db.VarChar(255)
  guest_id               String       @db.VarChar(128)
  promo_id               String       @db.Uuid
  qr_content_data        String?
  date_issued            DateTime?    @default(now()) @db.Timestamp(6)
  date_expires           DateTime?    @db.Timestamp(6)
  is_redeemed            Boolean?     @default(false)
  date_redeemed          DateTime?    @db.Timestamp(6)
  redeemed_by_manager_id String?      @db.Uuid
  userguest              userguest    @relation(fields: [guest_id], references: [guest_id], onDelete: NoAction, onUpdate: NoAction)
  promo                  promo        @relation(fields: [promo_id], references: [promo_id], onDelete: NoAction, onUpdate: NoAction)
  usermanager            usermanager? @relation(fields: [redeemed_by_manager_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
}

model usermanager {
  user_id                                                      String                           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name_first                                                   String                           @db.VarChar(50)
  name_last                                                    String                           @db.VarChar(50)
  email                                                        String                           @unique @db.VarChar(255)
  date_created                                                 DateTime?                        @default(now()) @db.Timestamp(6)
  active                                                       user_customer_active_status      @default(inactive)
  verification_status                                          user_manager_verification_status @default(waiting)
  plan_id                                                      Int                              @default(1)
  stripe_customer_id                                           String?                          @unique @db.VarChar(255)
  stripe_subscription_id                                       String?                          @unique @db.VarChar(255)
  stripe_price_id                                              String?                          @db.VarChar(255)
  stripe_current_period_start                                  DateTime?                        @db.Timestamp(6)
  stripe_current_period_end                                    DateTime?                        @db.Timestamp(6)
  stripe_payment_method_id                                     String?                          @db.VarChar(255)
  stripe_payment_method_brand                                  String?                          @db.VarChar(50)
  stripe_payment_method_last4                                  String?                          @db.VarChar(10)
  stripe_next_invoice_date                                     DateTime?                        @db.Timestamp(6)
  stripe_cancel_at_period_end                                  Boolean?
  stripe_canceled_at                                           DateTime?                        @db.Timestamp(6)
  stripe_status                                                String?                          @db.VarChar(50)
  subscription_status                                          String?                          @db.VarChar(50)
  birth_date                                                   DateTime?                        @db.Date
  birth_country                                                String?                          @db.VarChar(50)
  gender                                                       user_gender_type?
  residence_country                                            String?                          @db.VarChar(50)
  residence_region                                             String?                          @db.VarChar(50)
  residence_city                                               String?                          @db.VarChar(50)
  residence_address                                            String?                          @db.VarChar(80)
  tel                                                          String?                          @db.VarChar(20)
  password                                                     String                           @db.VarChar(255)
  token_activation                                             String?                          @unique @db.VarChar(255)
  updated_at                                                   DateTime                         @default(now()) @db.Timestamptz(6)
  appsupportrequest_appsupportrequest_assigned_toTousermanager appsupportrequest[]              @relation("appsupportrequest_assigned_toTousermanager")
  appsupportrequest_appsupportrequest_manager_idTousermanager  appsupportrequest[]              @relation("appsupportrequest_manager_idTousermanager")
  business                                                     business[]
  servicesupportrequest                                        servicesupportrequest[]
  usercustomerredemption                                       usercustomerredemption[]
  userguestredemption                                          userguestredemption[]
  plan                                                         plan                             @relation(fields: [plan_id], references: [plan_id], onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model servicequestion {
  question_id           Int                     @id @default(autoincrement())
  service_id            String                  @db.Uuid
  question_text         String                  @db.VarChar(500)
  question_type         String                  @db.VarChar(50)
  question_options      Json?
  max_length            Int?
  is_required           Boolean?                @default(false)
  display_order         Int?                    @default(0)
  is_active             Boolean?                @default(true)
  date_created          DateTime?               @default(now()) @db.Timestamp(6)
  date_updated          DateTime?               @default(now()) @db.Timestamp(6)
  bookingservice        service                 @relation(fields: [service_id], references: [service_id], onDelete: Cascade)
  servicequestionoption servicequestionoption[]
}

model servicequestionoption {
  option_id       Int             @id @default(autoincrement())
  question_id     Int
  option_text     String          @db.VarChar(255)
  display_order   Int?            @default(0)
  is_active       Boolean?        @default(true)
  date_created    DateTime?       @default(now()) @db.Timestamp(6)
  date_updated    DateTime?       @default(now()) @db.Timestamp(6)
  servicequestion servicequestion @relation(fields: [question_id], references: [question_id], onDelete: Cascade)
}

model servicerequirementblock {
  requirement_block_id Int       @id @default(autoincrement())
  service_id           String    @db.Uuid
  title                String?   @db.VarChar(255)
  requirements_text    String
  is_active            Boolean?  @default(true)
  is_required          Boolean?  @default(false)
  date_created         DateTime? @default(now()) @db.Timestamp(6)
  date_updated         DateTime? @default(now()) @db.Timestamp(6)
  bookingservice       service   @relation(fields: [service_id], references: [service_id], onDelete: Cascade)
}

model plan {
  plan_id           Int           @id
  plan_name         String        @unique @db.VarChar(50)
  display_price     String        @db.VarChar(50)
  display_frequency String?       @db.VarChar(20)
  plan_description  String?
  stripe_price_id   String        @unique @db.VarChar(255)
  stripe_product_id String        @unique @db.VarChar(255)
  plan_features     String[]      @default([])
  created_at        DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?     @default(now()) @db.Timestamptz(6)
  planlimit         planlimit[]
  usermanager       usermanager[]
}

model product {
  item_id          String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  business_id      String             @db.Uuid
  category_id      Int?
  item_name        String             @db.VarChar(100)
  display_order    Int?               @default(0)
  item_notes       String?            @db.VarChar(100)
  item_description String?            @db.VarChar(200)
  price            Decimal            @db.Decimal(10, 2)
  price_type       String?            @default("fixed") @db.VarChar(50)
  price_unit       String?            @db.VarChar(255)
  is_available     Boolean?           @default(true)
  image_available  Boolean?           @default(false)
  image_url        String?            @db.VarChar(155)
  date_created     DateTime?          @default(now()) @db.Timestamp(6)
  date_update      DateTime?          @default(now()) @db.Timestamp(6)
  business         business           @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  productcategory  productcategory?   @relation(fields: [category_id], references: [category_id])
  productvariation productvariation[]
}

model productcategory {
  category_id   Int       @id @default(autoincrement())
  business_id   String    @db.Uuid
  category_name String    @db.VarChar(50)
  display_order Int?      @default(0)
  date_created  DateTime? @default(now()) @db.Timestamp(6)
  date_update   DateTime? @default(now()) @db.Timestamp(6)
  product       product[]
  business      business  @relation(fields: [business_id], references: [business_id], onDelete: Cascade)

  @@unique([business_id, category_name])
}

model productvariation {
  variation_id           Int       @id @default(autoincrement())
  item_id                String    @db.Uuid
  variation_name         String    @db.VarChar(100)
  additional_description String?
  price_override         Decimal?  @db.Decimal(10, 2)
  price_modifier         Decimal?  @db.Decimal(10, 2)
  is_available           Boolean?  @default(true)
  display_order          Int?      @default(0)
  date_created           DateTime? @default(now()) @db.Timestamp(6)
  date_update            DateTime? @default(now()) @db.Timestamp(6)
  product                product   @relation(fields: [item_id], references: [item_id], onDelete: Cascade)

  @@unique([item_id, variation_name])
}

model service {
  service_id                      String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  business_id                     String                    @db.Uuid
  category_id                     Int?
  service_name                    String                    @db.VarChar(255)
  description                     String?
  duration_minutes                Int?
  buffer_minutes                  Int?
  price_base                      Decimal?                  @db.Decimal(10, 2)
  price_type                      String?                   @default("fixed") @db.VarChar(50)
  price_unit                      String?                   @db.VarChar(50)
  has_extras                      Boolean?                  @default(false)
  has_items                       Boolean?                  @default(false)
  available_booking               Boolean?                  @default(false)
  available_quotation             Boolean?                  @default(false)
  require_phone                   Boolean?                  @default(true)
  require_consent_pdp             Boolean?                  @default(true)
  require_consent_newsletter      Boolean?                  @default(false)
  require_consent_newsletter_text String?
  is_active                       Boolean?                  @default(true)
  display_order                   Int?                      @default(0)
  has_image                       Boolean?                  @default(false)
  demo                            Boolean?                  @default(false)
  date_created                    DateTime?                 @default(now()) @db.Timestamp(6)
  date_updated                    DateTime?                 @default(now()) @db.Timestamp(6)
  business                        business                  @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  servicecategory                 servicecategory?          @relation(fields: [category_id], references: [category_id])
  serviceboard                    serviceboard[]
  serviceevent                    serviceevent[]
  serviceextra                    serviceextra[]
  serviceitem                     serviceitem[]
  servicequestion                 servicequestion[]
  servicerequest                  servicerequest[]
  servicerequirementblock         servicerequirementblock[]
}

model serviceitem {
  service_item_id                   Int                                 @id @default(autoincrement())
  service_id                        String                              @db.Uuid
  item_name                         String                              @db.VarChar(255)
  item_description                  String?
  price_base                        Decimal                             @default(0.00) @db.Decimal(10, 2)
  price_type                        String                              @default("fixed") @db.VarChar(50)
  price_unit                        String?                             @db.VarChar(50)
  is_active                         Boolean?                            @default(true)
  display_order                     Int?                                @default(0)
  date_created                      DateTime?                           @default(now()) @db.Timestamp(6)
  date_updated                      DateTime?                           @default(now()) @db.Timestamp(6)
  service                           service                             @relation(fields: [service_id], references: [service_id], onDelete: Cascade)
  servicerequestselectedserviceitem servicerequestselectedserviceitem[]
}

model serviceextra {
  service_extra_id  Int       @id @default(autoincrement())
  service_id        String    @db.Uuid
  extra_name        String    @db.VarChar(255)
  extra_description String?
  price_base        Decimal   @default(0.00) @db.Decimal(10, 2)
  price_type        String    @default("fixed") @db.VarChar(50)
  price_unit        String?   @db.VarChar(50)
  is_active         Boolean?  @default(true)
  display_order     Int?      @default(0)
  date_created      DateTime? @default(now()) @db.Timestamp(6)
  date_updated      DateTime? @default(now()) @db.Timestamp(6)
  service           service   @relation(fields: [service_id], references: [service_id], onDelete: Cascade)
}

model servicerequest {
  request_id                        String                              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  request_reference                 String                              @unique @db.VarChar(50)
  business_id                       String                              @db.Uuid
  service_id                        String                              @db.Uuid
  customer_email                    String?                             @db.VarChar(255)
  customer_user_id                  String?                             @db.Uuid
  customer_name                     String?                             @db.VarChar(50)
  customer_phone                    String?                             @db.VarChar(50)
  event_id                          Int?
  request_datetimes                 Json?
  status                            request_status_type                 @default(pending)
  customer_notes                    String?
  internal_notes                    String?                             @db.VarChar(200)
  price_subtotal                    Decimal?                            @db.Decimal(10, 2)
  selected_service_items_snapshot   Json?
  question_responses_snapshot       Json?
  requirement_responses_snapshot    Json?
  consent_newsletter                Boolean?                            @default(false)
  consent_pdp                       Boolean?                            @default(false)
  staff_id                          Int?
  date_created                      DateTime?                           @default(now()) @db.Timestamp(6)
  date_updated                      DateTime?                           @default(now()) @db.Timestamp(6)
  is_handled                        Boolean?                            @default(false)
  handled_at                        DateTime?                           @db.Timestamp(6)
  handled_by                        String?                             @db.VarChar(100)
  priority                          String?                             @default("medium") @db.VarChar(20)
  urgency_flag                      Boolean?                            @default(false)
  is_closed                         Boolean?                            @default(false)
  assigned_to                       String?                             @db.VarChar(100)
  estimated_completion              DateTime?                           @db.Timestamp(6)
  actual_completion                 DateTime?                           @db.Timestamp(6)
  customer_satisfaction             Int?
  follow_up_required                Boolean?                            @default(false)
  follow_up_date                    DateTime?                           @db.Timestamp(6)
  tags                              Json?
  serviceboard                      serviceboard[]
  business                          business                            @relation(fields: [business_id], references: [business_id])
  usercustomer                      usercustomer?                       @relation(fields: [customer_user_id], references: [user_id], onDelete: Restrict)
  serviceevent                      serviceevent?                       @relation(fields: [event_id], references: [event_id])
  service                           service                             @relation(fields: [service_id], references: [service_id])
  servicerequestmessage             servicerequestmessage[]
  servicerequestselectedserviceitem servicerequestselectedserviceitem[]
  servicerequeststatushistory       servicerequeststatushistory[]
}

model servicerequestmessage {
  message_id     Int            @id @default(autoincrement())
  request_id     String         @db.Uuid
  message_text   String
  sent_at        DateTime?      @default(now()) @db.Timestamp(6)
  sender_type    String?        @default("manager") @db.VarChar(20)
  servicerequest servicerequest @relation(fields: [request_id], references: [request_id], onDelete: Cascade)
}

model servicerequestselectedserviceitem {
  request_selected_item_id Int            @id @default(autoincrement())
  request_id               String         @db.Uuid
  service_item_id          Int
  item_name                String         @db.VarChar(255)
  price_at_request         Decimal        @db.Decimal(10, 2)
  quantity                 Int            @default(1)
  date_created             DateTime?      @default(now()) @db.Timestamp(6)
  date_updated             DateTime?      @default(now()) @db.Timestamp(6)
  servicerequest           servicerequest @relation(fields: [request_id], references: [request_id], onDelete: Cascade)
  serviceitem              serviceitem    @relation(fields: [service_item_id], references: [service_item_id])

  @@unique([request_id, service_item_id], map: "servicerequestselectedserviceite_request_id_service_item_id_key")
}

model servicerequeststatushistory {
  status_history_id Int                 @id @default(autoincrement())
  request_id        String              @db.Uuid
  old_status        request_status_type
  new_status        request_status_type
  changed_at        DateTime?           @default(now()) @db.Timestamp(6)
  changed_by        String?             @db.VarChar(50)
  servicerequest    servicerequest      @relation(fields: [request_id], references: [request_id], onDelete: Cascade)
}

model servicecategory {
  category_id   Int       @id @default(autoincrement())
  business_id   String    @db.Uuid
  category_name String    @db.VarChar(255)
  description   String?
  display_order Int?      @default(0)
  service       service[]
  business      business  @relation(fields: [business_id], references: [business_id], onDelete: Cascade)

  @@unique([business_id, category_name], map: "uq_servicecategory_name_business")
}

model appointment {
  id                    String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  business_id           String              @db.Uuid
  service_board_id      String              @db.Uuid
  customer_id           String              @db.Uuid
  appointment_datetime  DateTime            @db.Timestamptz(6)
  appointment_type      String              @db.VarChar(50)
  appointment_location  String              @db.VarChar(255)
  appointment_title     String?             @db.VarChar(255)
  platform_name         String?             @db.VarChar(50)
  platform_link         String?             @db.VarChar(255)
  status                String              @default("scheduled") @db.VarChar(50)
  notes                 String?
  duration_minutes      Int?                @default(60)
  originating_action_id String?             @db.Uuid
  created_at            DateTime            @default(now()) @db.Timestamptz(6)
  updated_at            DateTime            @default(now()) @db.Timestamptz(6)
  business              business            @relation(fields: [business_id], references: [business_id], onUpdate: NoAction, map: "fk_appointment_business")
  serviceboardaction    serviceboardaction? @relation(fields: [originating_action_id], references: [action_id], onUpdate: NoAction, map: "fk_appointment_originating_action")
  serviceboard          serviceboard        @relation(fields: [service_board_id], references: [board_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_appointment_service_board")
  usercustomer          usercustomer        @relation(fields: [customer_id], references: [user_id], onUpdate: NoAction, map: "fk_appointment_user_customer")
}

model planlimit {
  id         Int      @id @default(autoincrement())
  plan_id    Int?
  feature    String   @db.VarChar(64)
  limit_type String   @db.VarChar(32)
  scope      String   @db.VarChar(32)
  value      Int?
  enabled    Boolean?
  notes      String?
  plan       plan?    @relation(fields: [plan_id], references: [plan_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([plan_id, feature])
}

model serviceboard {
  board_id              String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  business_id           String               @db.Uuid
  customer_id           String               @db.Uuid
  request_id            String?              @db.Uuid
  service_id            String?              @db.Uuid
  board_title           String               @db.VarChar(255)
  board_description     String?
  board_ref             String               @unique @db.VarChar(255)
  is_password_protected Boolean              @default(false)
  board_password        String?              @db.VarChar(30)
  status                String               @default("pending") @db.VarChar(50)
  action_count          Int                  @default(0)
  created_at            DateTime             @default(now()) @db.Timestamptz(6)
  updated_at            DateTime             @default(now()) @db.Timestamptz(6)
  appointment           appointment[]
  business              business             @relation(fields: [business_id], references: [business_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_sb_business")
  service               service?             @relation(fields: [service_id], references: [service_id], onUpdate: NoAction, map: "fk_sb_service")
  servicerequest        servicerequest?      @relation(fields: [request_id], references: [request_id], onUpdate: NoAction, map: "fk_sb_service_request")
  usercustomer          usercustomer         @relation(fields: [customer_id], references: [user_id], onUpdate: NoAction, map: "fk_sb_user_customer")
  serviceboardaction    serviceboardaction[]
}

model serviceboardaction {
  action_id                   String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  board_id                    String                  @db.Uuid
  customer_id                 String                  @db.Uuid
  action_type                 String                  @db.VarChar(50)
  action_title                String                  @db.VarChar(255)
  action_description          String?
  action_details              Json?
  action_status               String                  @default("pending") @db.VarChar(50)
  action_priority             String?                 @default("medium") @db.VarChar(20)
  created_at                  DateTime                @default(now()) @db.Timestamptz(6)
  updated_at                  DateTime                @default(now()) @db.Timestamptz(6)
  due_date                    DateTime?               @db.Timestamptz(6)
  is_customer_action_required Boolean                 @default(false)
  is_archived                 Boolean                 @default(false)
  appointment                 appointment[]
  serviceboard                serviceboard            @relation(fields: [board_id], references: [board_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_sba_service_board")
  usercustomer                usercustomer            @relation(fields: [customer_id], references: [user_id], onUpdate: NoAction, map: "fk_sba_user_customer")
  servicesupportrequest       servicesupportrequest[]
}

model usagecounter {
  id          Int       @id @default(autoincrement())
  business_id String    @db.Uuid
  feature     String    @db.VarChar(64)
  usage_count Int       @default(0)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([business_id, feature])
  @@index([business_id, feature], map: "idx_usagecounter_business_feature")
}

model usagecountermonthly {
  id          Int       @id @default(autoincrement())
  business_id String    @db.Uuid
  feature     String    @db.VarChar(64)
  year        Int
  month       Int
  usage_count Int       @default(0)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([business_id, feature, year, month])
  @@index([business_id, feature, year, month], map: "idx_usagecountermonthly_business_feature_month")
}

model quotation {
  id               Int       @id @default(autoincrement())
  business_id      String    @db.Uuid
  request_id       String    @db.Uuid
  quotation_number String    @unique @db.VarChar(50)
  quotation_data   Json
  status           String?   @default("draft") @db.VarChar(50)
  sent_at          DateTime? @db.Timestamptz(6)
  expires_at       DateTime? @db.Timestamptz(6)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)

  @@index([status], map: "idx_quotation_status")
  @@index([business_id], map: "idx_quotation_business")
  @@index([request_id], map: "idx_quotation_request")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model attachments {
  id                 BigInt                 @id @default(autoincrement())
  file_path          String                 @db.VarChar(255)
  file_name          String?                @db.VarChar(255)
  support_request_id String?                @db.Uuid
  user_id            String?                @db.Uuid
  created_at         DateTime               @default(now()) @db.Timestamptz(6)
  feedback_id        BigInt?
  feedback           feedback?              @relation(fields: [feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  support_requests   servicesupportrequest? @relation(fields: [support_request_id], references: [support_request_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_attachments_support_request_id")

  @@index([support_request_id], map: "idx_attachments_support_request_id")
  @@index([user_id], map: "idx_attachments_user_id")
  @@index([feedback_id], map: "idx_attachments_feedback_id")
}

model serviceevent {
  event_id                 Int                        @id @default(autoincrement())
  service_id               String                     @db.Uuid
  event_name               String                     @db.VarChar(255)
  event_description        String?
  event_type               String                     @default("appointment") @db.VarChar(50)
  duration_minutes         Int?                       @default(60)
  buffer_minutes           Int?                       @default(0)
  is_required              Boolean?                   @default(true)
  display_order            Int?                       @default(0)
  is_active                Boolean?                   @default(true)
  date_created             DateTime?                  @default(now()) @db.Timestamp(6)
  date_updated             DateTime?                  @default(now()) @db.Timestamp(6)
  service                  service                    @relation(fields: [service_id], references: [service_id], onDelete: Cascade)
  serviceeventavailability serviceeventavailability[]
  servicerequest           servicerequest[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model serviceeventavailability {
  availability_id     Int           @id @default(autoincrement())
  event_id            Int?
  business_id         String        @db.Uuid
  staff_id            Int?
  day_of_week         Int           @db.SmallInt
  time_start          DateTime      @db.Time(6)
  time_end            DateTime      @db.Time(6)
  is_recurring        Boolean?      @default(true)
  date_effective_from DateTime?     @db.Date
  date_effective_to   DateTime?     @db.Date
  date_created        DateTime?     @default(now()) @db.Timestamp(6)
  date_updated        DateTime?     @default(now()) @db.Timestamp(6)
  business            business      @relation(fields: [business_id], references: [business_id], onDelete: Cascade)
  serviceevent        serviceevent? @relation(fields: [event_id], references: [event_id], onDelete: Cascade)
}

model aiassistantmessagehistory {
  message_id        BigInt   @id @default(autoincrement())
  business_id       String   @db.Uuid
  session_id        String?  @db.VarChar(255)
  user_message      String
  ai_response       String?
  message_type      String?  @default("conversation") @db.VarChar(50)
  request_type      String?  @default("openai") @db.VarChar(50)
  input_tokens      Int?
  output_tokens     Int?
  cost_usd          Decimal? @db.Decimal(10, 6)
  response_time_ms  Int?
  success           Boolean? @default(true)
  error_message     String?
  user_ip           String?  @db.VarChar(45)
  user_agent        String?
  validation_passed Boolean? @default(true)
  validation_errors String?
  rate_limited      Boolean? @default(false)
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  business          business @relation(fields: [business_id], references: [business_id], onDelete: Cascade)

  @@index([business_id], map: "idx_ai_message_history_business_id")
  @@index([created_at], map: "idx_ai_message_history_created_at")
  @@index([message_type], map: "idx_ai_message_history_message_type")
  @@index([request_type], map: "idx_ai_message_history_request_type")
  @@index([session_id], map: "idx_ai_message_history_session_id")
  @@index([success], map: "idx_ai_message_history_success")
  @@index([validation_passed], map: "idx_ai_message_history_validation_passed")
}

model aicontentgenerationratelimit {
  id                    Int      @id @default(autoincrement())
  business_id           String   @unique @db.Uuid
  generations_available Int      @default(0)
  fill_rate             Int      @default(1)
  last_refill           DateTime @default(now()) @db.Timestamptz(6)
  created_at            DateTime @default(now()) @db.Timestamptz(6)
  updated_at            DateTime @default(now()) @db.Timestamptz(6)
  business              business @relation(fields: [business_id], references: [business_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([business_id], map: "idx_aicontentgenerationratelimit_business")
}

model aigenerationemail {
  id                            Int      @id @default(autoincrement())
  business_id                   String   @db.Uuid
  generation_date               DateTime @default(now()) @db.Timestamptz(6)
  past_customers_subject        String?
  past_customers_body           String?
  uncommitted_customers_subject String?
  uncommitted_customers_body    String?
  services_text                 String?
  past_customers_text           String?
  uncommitted_customers_text    String?
  created_at                    DateTime @default(now()) @db.Timestamptz(6)
  business                      business @relation(fields: [business_id], references: [business_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([business_id], map: "idx_aigenerationemail_business")
  @@index([generation_date], map: "idx_aigenerationemail_date")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model appsupportrequest {
  support_request_id                                     String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  business_id                                            String                @db.Uuid
  manager_id                                             String                @db.Uuid
  message                                                String
  priority                                               app_support_priority? @default(medium)
  category                                               app_support_category  @default(general)
  status                                                 app_support_status    @default(open)
  assigned_to                                            String?               @db.Uuid
  resolution_notes                                       String?
  created_at                                             DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at                                             DateTime?             @default(now()) @db.Timestamptz(6)
  usermanager_appsupportrequest_assigned_toTousermanager usermanager?          @relation("appsupportrequest_assigned_toTousermanager", fields: [assigned_to], references: [user_id], onUpdate: NoAction, map: "fk_asr_assigned_to")
  business                                               business              @relation(fields: [business_id], references: [business_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_asr_business")
  usermanager_appsupportrequest_manager_idTousermanager  usermanager           @relation("appsupportrequest_manager_idTousermanager", fields: [manager_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_asr_manager")

  @@index([business_id], map: "idx_appsupportrequest_business_id")
  @@index([business_id, status], map: "idx_appsupportrequest_business_status")
  @@index([category], map: "idx_appsupportrequest_category")
  @@index([created_at], map: "idx_appsupportrequest_created_at")
  @@index([manager_id], map: "idx_appsupportrequest_manager_id")
  @@index([priority], map: "idx_appsupportrequest_priority")
  @@index([status], map: "idx_appsupportrequest_status")
}

model emailcampaign {
  id                     Int                      @id @default(autoincrement())
  business_id            String                   @db.Uuid
  campaign_name          String                   @db.VarChar(255)
  subject                String                   @db.VarChar(255)
  content                String
  from_name              String                   @db.VarChar(255)
  from_email             String                   @db.VarChar(255)
  reply_to               String?                  @db.VarChar(255)
  recipient_count        Int                      @default(0)
  sent_count             Int                      @default(0)
  failed_count           Int                      @default(0)
  status                 String                   @default("draft") @db.VarChar(50)
  scheduled_at           DateTime?                @db.Timestamptz(6)
  sent_at                DateTime?                @db.Timestamptz(6)
  created_at             DateTime?                @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?                @default(now()) @db.Timestamptz(6)
  emailcampaignrecipient emailcampaignrecipient[]

  @@index([business_id], map: "idx_emailcampaign_business")
  @@index([status], map: "idx_emailcampaign_status")
}

model emailcampaignrecipient {
  id            Int            @id @default(autoincrement())
  campaign_id   Int?
  customer_id   String         @db.Uuid
  email         String         @db.VarChar(255)
  status        String         @default("pending") @db.VarChar(50)
  sent_at       DateTime?      @db.Timestamptz(6)
  error_message String?
  created_at    DateTime?      @default(now()) @db.Timestamptz(6)
  emailcampaign emailcampaign? @relation(fields: [campaign_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([campaign_id], map: "idx_emailcampaignrecipient_campaign")
  @@index([status], map: "idx_emailcampaignrecipient_status")
}

model emailratelimit {
  id               Int      @id @default(autoincrement())
  business_id      String   @unique @db.Uuid
  tokens_available Int      @default(0)
  fill_rate        Int      @default(10)
  last_refill      DateTime @default(now()) @db.Timestamptz(6)
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  updated_at       DateTime @default(now()) @db.Timestamptz(6)
  business         business @relation(fields: [business_id], references: [business_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([business_id], map: "idx_emailratelimit_business")
}

model feedback {
  id                       BigInt                    @id @default(autoincrement())
  user_id                  String?                   @db.Uuid
  feedback_type            feedback_type_enum
  message                  String
  status                   feedback_status_enum      @default(new)
  is_anonymous             Boolean                   @default(false)
  created_at               DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime                  @default(now()) @db.Timestamptz(6)
  attachments              attachments[]
  feedbackbugreports       feedbackbugreports?
  feedbackfeaturerequests  feedbackfeaturerequests?
  feedbacklanguagerequests feedbacklanguagerequests?
  feedbacksuggestions      feedbacksuggestions?

  @@index([created_at], map: "idx_feedback_created_at")
  @@index([status], map: "idx_feedback_status")
  @@index([feedback_type], map: "idx_feedback_type")
  @@index([user_id], map: "idx_feedback_user_id")
}

model feedbackbugreports {
  id                 BigInt             @id @default(autoincrement())
  feedback_id        BigInt             @unique
  steps_to_reproduce String?
  app_version        String?            @db.VarChar(50)
  device_info        String?
  expected_vs_actual String?
  severity           bug_severity_enum?
  created_at         DateTime           @default(now()) @db.Timestamptz(6)
  feedback           feedback           @relation(fields: [feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([feedback_id], map: "idx_feedbackbugreports_feedback_id")
}

model feedbackfeaturerequests {
  id          BigInt   @id @default(autoincrement())
  feedback_id BigInt   @unique
  use_case    String?
  impact      String?  @db.VarChar(20)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  feedback    feedback @relation(fields: [feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([feedback_id], map: "idx_feedbackfeaturerequests_feedback_id")
}

model feedbacklanguagerequests {
  id            BigInt   @id @default(autoincrement())
  feedback_id   BigInt   @unique
  language_code String   @db.VarChar(10)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  feedback      feedback @relation(fields: [feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([feedback_id], map: "idx_feedbacklanguagerequests_feedback_id")
}

model feedbacksuggestions {
  id          BigInt   @id @default(autoincrement())
  feedback_id BigInt   @unique
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  feedback    feedback @relation(fields: [feedback_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([feedback_id], map: "idx_feedbacksuggestions_feedback_id")
}

model marketingemailcampaign {
  id                 BigInt    @id @default(autoincrement())
  business_id        String    @db.Uuid
  campaign_name      String    @db.VarChar(255)
  subject            String    @db.VarChar(255)
  content            String
  from_name          String    @db.VarChar(255)
  from_email         String    @db.VarChar(255)
  reply_to           String?   @db.VarChar(255)
  recipient_category String    @default("past_customers") @db.VarChar(50)
  sent_count         Int       @default(0)
  failed_count       Int       @default(0)
  opened_count       Int       @default(0)
  clicked_count      Int       @default(0)
  status             String    @default("draft") @db.VarChar(50)
  campaign_type      String    @default("general") @db.VarChar(50)
  scheduled_at       DateTime? @db.Timestamptz(6)
  sent_at            DateTime? @db.Timestamptz(6)
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)
  business           business  @relation(fields: [business_id], references: [business_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([business_id], map: "idx_marketing_email_campaign_business_id")
  @@index([recipient_category], map: "idx_marketing_email_campaign_recipient_category")
  @@index([scheduled_at], map: "idx_marketing_email_campaign_scheduled_at")
  @@index([status], map: "idx_marketing_email_campaign_status")
  @@index([campaign_type], map: "idx_marketing_email_campaign_type")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model servicesupportrequest {
  support_request_id String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  business_id        String                    @db.Uuid
  board_ref          String                    @db.VarChar(255)
  customer_id        String?                   @db.Uuid
  message            String
  related_action_id  String?                   @db.Uuid
  email              String?                   @db.VarChar(255)
  priority           service_support_priority?
  category           service_support_category  @default(general)
  status             service_support_status    @default(open)
  assigned_to        String?                   @db.Uuid
  resolution_notes   String?
  created_at         DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?                 @default(now()) @db.Timestamptz(6)
  attachments        attachments[]
  usermanager        usermanager?              @relation(fields: [assigned_to], references: [user_id], onUpdate: NoAction, map: "fk_ssr_assigned_to")
  business           business                  @relation(fields: [business_id], references: [business_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ssr_business")
  usercustomer       usercustomer?             @relation(fields: [customer_id], references: [user_id], onUpdate: NoAction, map: "fk_ssr_customer")
  serviceboardaction serviceboardaction?       @relation(fields: [related_action_id], references: [action_id], onUpdate: NoAction, map: "fk_ssr_related_action")

  @@index([board_ref], map: "idx_servicesupportrequest_board_ref")
  @@index([business_id, board_ref], map: "idx_servicesupportrequest_business_board")
  @@index([business_id], map: "idx_servicesupportrequest_business_id")
  @@index([business_id, status], map: "idx_servicesupportrequest_business_status")
  @@index([category], map: "idx_servicesupportrequest_category")
  @@index([created_at], map: "idx_servicesupportrequest_created_at")
  @@index([customer_id], map: "idx_servicesupportrequest_customer_id")
  @@index([priority], map: "idx_servicesupportrequest_priority")
  @@index([related_action_id], map: "idx_servicesupportrequest_related_action_id")
  @@index([status], map: "idx_servicesupportrequest_status")
}

enum business_sponsorship_level {
  basic
  premium
}

enum business_sponsorship_payment_status {
  pending
  paid
  failed
}

enum customer_card_status {
  active
  inactive
  blocked
}

enum promo_challenge_type {
  password
  survey
  social
}

enum survey_answer_question_type {
  business
  prebuilt
}

enum survey_question_format_type {
  text
  number
  radio
  checkbox
  rating
}

enum survey_question_source_type {
  custom
  prebuilt
}

enum user_customer_active_status {
  active
  inactive
  blocked
  guest
}

enum user_gender_type {
  M
  F
  Other
  Prefer_Not_To_Say @map("Prefer Not To Say")
}

enum user_manager_verification_status {
  waiting
  in_progress
  verified
  negative
}

enum request_status_type {
  pending
  confirmed
  cancelled
  completed
  rescheduled
}

enum app_support_category {
  general
  technical
  billing
  feature_request
  bug_report
}

enum app_support_priority {
  low
  medium
  high
  urgent
}

enum app_support_status {
  open
  in_progress
  resolved
  closed
}

enum bug_severity_enum {
  low
  medium
  high
  critical
}

enum feedback_status_enum {
  new
  in_progress
  resolved
  closed
}

enum feedback_type_enum {
  bug_report
  feature_request
  suggestion
  language_request
}

enum service_support_category {
  general
  technical
  account
}

enum service_support_priority {
  low
  medium
  high
  urgent
}

enum service_support_status {
  open
  in_progress
  resolved
  closed
}
